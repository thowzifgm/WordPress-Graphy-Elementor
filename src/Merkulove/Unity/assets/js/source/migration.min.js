import{saveAs}from"file-saver";!function(e){"use strict";e(document).ready((function(){const t=document.querySelector("#mdp-export-btn"),{ajaxURL:o,nonce:r}=mdpGraphistElementor;try{new Blob}catch(e){console.warn("Settings export not available.")}finally{t.addEventListener("click",t=>{t.preventDefault();let n=new XMLHttpRequest;n.open("POST",o,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded;"),n.responseType="json",n.onload=()=>{if(200===n.status){"object"!=typeof n.response&&(console.warn("Wrong settings format! See details above:"),console.warn(n.response));let t="graphist-elementor-settings.json",o=new Blob([JSON.stringify(n.response,null,4)],{type:"application/json",name:t});saveAs(o,t),e("#submit").click()}else console.error(`${n.statusText}: ${n.status}. Error during settings export! See details above:`),console.error(n)},n.onerror=()=>{console.error("Error sending request!")},n.send("action=export_settings_graphist_elementor&nonce="+r)})}let n=e(".mdp-tab-name-migration .mdp-drop-zone");n.on("dragenter",(function(){p(),e(this).addClass("mdp-hover")})),n.on("dragleave",(function(){e(this).removeClass("mdp-hover")})),n.on("dragover",(function(e){e.stopPropagation(),e.preventDefault()}));let s=e(".mdp-drop-zone-input");function a(t){let s=new FileReader;s.onload=function(t){let s=t.target.result,a=JSON.parse(s);if(!function(e){try{JSON.parse(e)}catch(e){return!1}return!0}(s))return l("Error: Uploaded file is empty or not a valid JSON file."),void n.removeClass("mdp-busy");if(void 0===JSON.parse(s).plugin_info)return l("Error: Your API key file looks like not valid. Please make sure you use the correct key."),void n.removeClass("mdp-busy");p();let i=new XMLHttpRequest;i.open("POST",o,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded;"),i.onload=()=>{if(200===i.status){const t=JSON.parse(i.response);t.status?e("#submit").click():(l("Error: "+t.message),n.removeClass("mdp-busy"))}else console.error("Error during settings import! See details above:"),console.error(i)},i.onerror=()=>{console.error("Error sending request!")},i.send(`action=import_settings_graphist_elementor&nonce=${r}&import=${encodeURIComponent(JSON.stringify(a))}`)},s.readAsText(t)}n.on("drop",(function(t){t.stopPropagation(),t.preventDefault(),e(this).removeClass("mdp-hover"),n.addClass("mdp-busy");let o=t.originalEvent.dataTransfer.files[0];d(o)?a(o):n.removeClass("mdp-busy")}));let i=e("#mdp-dnd-file-input");function l(e){n.next().addClass("mdp-error").html(e)}function p(){n.next().removeClass("mdp-error").html("")}function d(e){return null==e?(l("Error: Failed to read file. Please try again."),!1):!!e.type.match("application/json")||(l("Error: API Key must be a valid JSON file."),!1)}n.on("click",(function(){i.click()})),i.on("change",(function(e){n.addClass("mdp-busy");let t=e.target.files[0];d(t)?a(t):n.removeClass("mdp-busy")})),e(".mdp-reset-key-btn").on("click",(function(){s.val(""),e("#submit").trigger("click")}))}))}(jQuery);